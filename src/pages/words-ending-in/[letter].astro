---
import Layout from '@/layouts/Layout.astro';
import { getMeta } from '@/lib/meta';
import { getAllWords } from '@/lib/words-data';

export function getStaticPaths() {
  return 'abcdefghijklmnopqrstuvwxyz'.split('').map((letter) => ({
    params: { letter },
    props: { letter },
  }));
}

const { letter } = Astro.props;
const letterLower = letter.toLowerCase();
const allWords = getAllWords();
const wordsEndingWith = allWords.filter((w) => w.endsWith(letterLower));

const groupedByLength: Record<number, string[]> = {};
for (let len = 10; len >= 2; len--) {
  groupedByLength[len] = wordsEndingWith.filter((w) => w.length === len).sort();
}

const meta = getMeta(
  `/words-ending-in/${letter}`,
  `Words Ending in ${letter.toUpperCase()}`,
  `${wordsEndingWith.length} English words that end with ${letter.toUpperCase()}. Grouped by length from 2 to 10 letters. No sign-up.`
);
---

<Layout meta={meta}>
  <nav class="mb-6">
    <a href="/words-ending-in" class="text-sm text-muted-foreground hover:text-primary">← Back to Words Ending In</a>
  </nav>

  <header class="flex flex-wrap items-center gap-4 mb-8">
    <div class="flex items-center justify-center w-16 h-16 rounded-lg bg-primary text-white text-3xl font-bold uppercase">
      {letter}
    </div>
    <div>
      <h1 class="text-4xl font-bold text-foreground">Words Ending in {letter.toUpperCase()}</h1>
      <p class="text-muted-foreground mt-1">{wordsEndingWith.length} words</p>
    </div>
  </header>

  <nav aria-label="Letter A–Z" class="mb-8">
    <ul class="flex flex-wrap gap-2 list-none pl-0">
      {['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z'].map((l) => (
        <li>
          <a
            href={`/words-ending-in/${l}`}
            class:list={[
              'inline-flex items-center justify-center w-10 h-10 rounded-lg border font-semibold uppercase transition-colors',
              l === letterLower ? 'bg-primary text-white border-primary' : 'border-border bg-card hover:bg-muted hover:border-primary text-primary',
            ]}
          >
            {l}
          </a>
        </li>
      ))}
    </ul>
  </nav>

  {wordsEndingWith.length > 0 ? (
    <div class="space-y-6">
      {[10, 9, 8, 7, 6, 5, 4, 3, 2].map((len) => {
        const words = groupedByLength[len] ?? [];
        if (words.length === 0) return null;
        const preview = words.slice(0, 24);
        const rest = words.slice(24);
        return (
          <section class="rounded-lg border border-border bg-card p-4">
            <h2 class="text-xl font-semibold mb-3 text-foreground">{len}-Letter Words ({words.length})</h2>
            <ul class="flex flex-wrap gap-2 list-none pl-0">
              {preview.map((w) => (
                <li><a href={`/${len}-letter-words`} class="text-primary hover:underline font-medium">{w}</a></li>
              ))}
              {rest.length > 0 ? (
                <li>
                  <details class="inline">
                    <summary class="cursor-pointer text-primary hover:underline">+{rest.length} more</summary>
                    <ul class="flex flex-wrap gap-2 mt-2 pl-0 list-none">
                      {rest.map((w) => (
                        <li><a href={`/${len}-letter-words`} class="text-primary hover:underline font-medium">{w}</a></li>
                      ))}
                    </ul>
                  </details>
                </li>
              ) : null}
            </ul>
          </section>
        );
      })}
    </div>
  ) : (
    <p class="text-lg text-muted-foreground rounded-lg border border-border bg-card p-8 text-center">
      No words found ending in "{letter.toUpperCase()}".
    </p>
  )}
</Layout>
